<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editable Account Portfolio Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 10px;
            background-color: #f5f5f5;
        }
        
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 100%;
            overflow-x: auto;
        }
        
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            font-size: 24px;
        }
        
        .summary {
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .controls {
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .save-btn {
            background-color: #27ae60;
        }
        
        .save-btn:hover {
            background-color: #219a52;
        }
        
        .reset-btn {
            background-color: #e74c3c;
        }
        
        .reset-btn:hover {
            background-color: #c0392b;
        }
        
        .status-indicator {
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .unsaved {
            background-color: #f39c12;
            color: white;
        }
        
        .saved {
            background-color: #27ae60;
            color: white;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 11px;
        }
        
        th, td {
            border: 1px solid #bdc3c7;
            padding: 6px;
            text-align: left;
            vertical-align: top;
        }
        
        th {
            background-color: #34495e;
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
            font-size: 10px;
        }
        
        /* Risk-based row coloring */
        .high-risk {
            background-color: #ffebee;
            border-left: 4px solid #f44336;
        }
        
        .medium-risk {
            background-color: #fff3e0;
            border-left: 4px solid #ff9800;
        }
        
        .low-risk {
            background-color: #e8f5e8;
            border-left: 4px solid #4caf50;
        }
        
        .kevin-assigned {
            font-weight: bold;
        }
        
        .expired {
            background-color: #ffcdd2 !important;
            color: #c62828;
            font-weight: bold;
        }
        
        .expiring-soon {
            background-color: #ffe0b2 !important;
            color: #e65100;
            font-weight: bold;
        }
        
        .new-account {
            background-color: #e1f5fe;
            border: 2px dashed #0277bd;
        }
        
        /* Editable cells */
        .editable {
            cursor: text;
            min-height: 20px;
            padding: 4px;
        }
        
        .editable:hover {
            background-color: #f8f9fa;
            outline: 1px dashed #3498db;
        }
        
        .editable:focus {
            background-color: white;
            outline: 2px solid #3498db;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }
        
        .dropdown-editable {
            border: none;
            background: transparent;
            width: 100%;
            font-size: 11px;
            cursor: pointer;
        }
        
        .dropdown-editable:focus {
            outline: 1px solid #3498db;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
            font-size: 11px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 20px;
            height: 12px;
            border-radius: 3px;
        }
        
        .modified-row {
            box-shadow: 0 0 3px rgba(241, 196, 15, 0.8);
        }
        
        @media (max-width: 1200px) {
            .container {
                padding: 10px;
            }
            
            table {
                font-size: 10px;
            }
            
            th, td {
                padding: 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>📊 EDITABLE ACCOUNT PORTFOLIO DASHBOARD</h1>
        
        <div class="summary">
            <strong>Portfolio Update:</strong> 52 Total Accounts | Kevin's 27 Assignments | Live Editing Enabled<br>
            <strong>Risk Status:</strong> <span id="riskSummary">9 High Risk | 38 Medium Risk | 5 Low Risk</span><br>
            <strong>Editing:</strong> Click any cell to edit | Changes auto-tracked | Export saves current state
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background-color: #ffebee; border-left: 4px solid #f44336;"></div>
                <span>High Risk</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #fff3e0; border-left: 4px solid #ff9800;"></div>
                <span>Medium Risk</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #e8f5e8; border-left: 4px solid #4caf50;"></div>
                <span>Low Risk</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #e1f5fe; border: 2px dashed #0277bd;"></div>
                <span>New Account</span>
            </div>
            <div class="legend-item">
                <strong>Bold = Kevin's Assignment</strong>
            </div>
        </div>
        
        <div class="controls">
            <button onclick="filterTable('all')">All Accounts</button>
            <button onclick="filterTable('kevin')">Kevin's 27</button>
            <button onclick="filterTable('high-risk')">High Risk</button>
            <button onclick="filterTable('new')">New Accounts</button>
            <span class="status-indicator" id="saveStatus">Ready to Edit</span>
            <button class="save-btn" onclick="saveChanges()">💾 Save Changes</button>
            <button class="reset-btn" onclick="resetChanges()">🔄 Reset All</button>
            <button onclick="exportToCSV()">📥 Export CSV</button>
            <button onclick="addNewAccount()">➕ Add Account</button>
        </div>
        
        <div style="overflow-x: auto;">
            <table id="accountTable">
                <thead>
                    <tr>
                        <th>Account Name</th>
                        <th>Total ARR</th>
                        <th>Renewal Date</th>
                        <th>Geography</th>
                        <th>Commercial Partner</th>
                        <th>CSM Partner</th>
                        <th>Executive POC</th>
                        <th>POC Location</th>
                        <th>Engagement Status</th>
                        <th>Churn Risk</th>
                        <th>Concerns</th>
                        <th>Action Plan</th>
                        <th>Action Date</th>
                        <th>Status</th>
                        <th>Kevin Assigned</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="accountTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Account data structure
        let accountData = [
            {
                name: "Hughes Network Systems",
                arr: "$233,763.00",
                renewal: "TBD",
                geo: "North America",
                commercial: "Andrew Mugisha",
                csm: "Emin Medic",
                poc: "TBD",
                location: "TBD",
                engagement: "No Communication Found",
                risk: "High",
                concerns: "Highest ARR account with no communication history - critical assessment needed",
                actionPlan: "Reach out to Andrew Mugisha cc Emin Medic for account handoff and comprehensive health check",
                actionDate: "Next week",
                status: "Planned",
                kevinAssigned: "YES",
                isNew: true,
                classes: "high-risk kevin-assigned new-account"
            },
            {
                name: "Western Governors University",
                arr: "$230,205.00",
                renewal: "TBD",
                geo: "North America",
                commercial: "Andrew Mugisha",
                csm: "Emin Medic",
                poc: "TBD",
                location: "Salt Lake City, Utah",
                engagement: "No Communication Found",
                risk: "High",
                concerns: "High ARR education account with no communication history",
                actionPlan: "Reach out to Andrew Mugisha cc Emin Medic for account handoff and education sector assessment",
                actionDate: "Next week",
                status: "Planned",
                kevinAssigned: "YES",
                isNew: true,
                classes: "high-risk kevin-assigned new-account"
            },
            {
                name: "American Chemical Society",
                arr: "$223,604.55",
                renewal: "6/30/2025",
                geo: "North America",
                commercial: "Andrew Mugisha",
                csm: "Kevin Botha",
                poc: "Megan Jacob",
                location: "Washington DC",
                engagement: "Critical",
                risk: "High",
                concerns: "Renewal expired, no recent communication",
                actionPlan: "Liaise with account manager and escalate to renewal team",
                actionDate: "This week",
                status: "Planned",
                kevinAssigned: "NO",
                isNew: false,
                classes: "high-risk",
                special: "expired"
            },
            {
                name: "Sisense Inc.",
                arr: "$163,381.55",
                renewal: "TBD",
                geo: "North America",
                commercial: "Lethicia Mares",
                csm: "Kevin Botha",
                poc: "Jackie Pacheco, David Raynor",
                location: "New York, NY",
                engagement: "Active Monthly Syncs",
                risk: "Low",
                concerns: "Positive - Active monthly syncs established",
                actionPlan: "Continue monthly sync meetings, product enhancement requests submitted",
                actionDate: "Ongoing",
                status: "Active",
                kevinAssigned: "YES",
                isNew: false,
                classes: "low-risk kevin-assigned"
            },
            {
                name: "Staples",
                arr: "$111,750.00",
                renewal: "TBD",
                geo: "North America",
                commercial: "Lethicia Mares",
                csm: "Muhammad Khwaja",
                poc: "Micah Ary, Lindsey Perry, Melisa Courtney",
                location: "Framingham, MA",
                engagement: "Active Monthly Meetings",
                risk: "Low",
                concerns: "Active monthly meetings established",
                actionPlan: "Continue regular monthly meetings with team",
                actionDate: "Ongoing",
                status: "Active",
                kevinAssigned: "YES",
                isNew: true,
                classes: "low-risk kevin-assigned new-account"
            }
            // Add more sample data here - truncated for readability
        ];
        
        let originalData = JSON.parse(JSON.stringify(accountData)); // Deep copy for reset
        let hasUnsavedChanges = false;
        
        function renderTable() {
            const tbody = document.getElementById('accountTableBody');
            tbody.innerHTML = '';
            
            accountData.forEach((account, index) => {
                const row = document.createElement('tr');
                row.className = account.classes;
                row.dataset.index = index;
                
                if (account.special === 'expired') row.classList.add('expired');
                if (account.special === 'expiring') row.classList.add('expiring-soon');
                
                row.innerHTML = `
                    <td class="editable" data-field="name">${account.kevinAssigned === 'YES' ? '<strong>' + account.name + '</strong>' : account.name}</td>
                    <td class="editable" data-field="arr">${account.arr}</td>
                    <td class="editable ${account.special || ''}" data-field="renewal">${account.renewal}</td>
                    <td class="editable" data-field="geo">${account.geo}</td>
                    <td class="editable" data-field="commercial">${account.commercial}</td>
                    <td class="editable" data-field="csm">${account.csm}</td>
                    <td class="editable" data-field="poc">${account.poc}</td>
                    <td class="editable" data-field="location">${account.location}</td>
                    <td class="editable" data-field="engagement">${account.engagement}</td>
                    <td class="editable-dropdown" data-field="risk">
                        <select class="dropdown-editable" onchange="updateRisk(${index}, this.value)">
                            <option value="High" ${account.risk === 'High' ? 'selected' : ''}>High</option>
                            <option value="Medium" ${account.risk === 'Medium' ? 'selected' : ''}>Medium</option>
                            <option value="Low" ${account.risk === 'Low' ? 'selected' : ''}>Low</option>
                        </select>
                    </td>
                    <td class="editable" data-field="concerns">${account.concerns}</td>
                    <td class="editable" data-field="actionPlan">${account.actionPlan}</td>
                    <td class="editable" data-field="actionDate">${account.actionDate}</td>
                    <td class="editable-dropdown" data-field="status">
                        <select class="dropdown-editable" onchange="updateField(${index}, 'status', this.value)">
                            <option value="Planned" ${account.status === 'Planned' ? 'selected' : ''}>Planned</option>
                            <option value="In Progress" ${account.status === 'In Progress' ? 'selected' : ''}>In Progress</option>
                            <option value="Active" ${account.status === 'Active' ? 'selected' : ''}>Active</option>
                            <option value="Completed" ${account.status === 'Completed' ? 'selected' : ''}>Completed</option>
                            <option value="Escalated" ${account.status === 'Escalated' ? 'selected' : ''}>Escalated</option>
                        </select>
                    </td>
                    <td class="editable-dropdown" data-field="kevinAssigned">
                        <select class="dropdown-editable" onchange="updateKevinAssignment(${index}, this.value)">
                            <option value="YES" ${account.kevinAssigned === 'YES' ? 'selected' : ''}>YES</option>
                            <option value="NO" ${account.kevinAssigned === 'NO' ? 'selected' : ''}>NO</option>
                        </select>
                    </td>
                    <td>
                        <button onclick="duplicateAccount(${index})" style="font-size: 10px; padding: 2px 6px;">📋</button>
                        <button onclick="deleteAccount(${index})" style="font-size: 10px; padding: 2px 6px; background: #e74c3c;">🗑️</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Add event listeners for editable cells
            addEditListeners();
            updateRiskSummary();
        }
        
        function addEditListeners() {
            document.querySelectorAll('.editable').forEach(cell => {
                cell.contentEditable = true;
                cell.addEventListener('blur', function() {
                    const index = this.closest('tr').dataset.index;
                    const field = this.dataset.field;
                    const newValue = this.textContent.trim();
                    updateField(index, field, newValue);
                });
                
                cell.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.blur();
                    }
                });
            });
        }
        
        function updateField(index, field, value) {
            if (accountData[index][field] !== value) {
                accountData[index][field] = value;
                markAsModified(index);
                updateSaveStatus(true);
            }
        }
        
        function updateRisk(index, risk) {
            accountData[index].risk = risk;
            updateRowClass(index);
            markAsModified(index);
            updateSaveStatus(true);
            updateRiskSummary();
        }
        
        function updateKevinAssignment(index, assigned) {
            accountData[index].kevinAssigned = assigned;
            updateRowClass(index);
            markAsModified(index);
            updateSaveStatus(true);
            renderTable(); // Re-render to update bold formatting
        }
        
        function updateRowClass(index) {
            const row = document.querySelector(`tr[data-index="${index}"]`);
            const account = accountData[index];
            
            // Reset classes
            row.className = '';
            
            // Apply risk class
            if (account.risk === 'High') row.classList.add('high-risk');
            else if (account.risk === 'Medium') row.classList.add('medium-risk');
            else if (account.risk === 'Low') row.classList.add('low-risk');
            
            // Apply assignment class
            if (account.kevinAssigned === 'YES') row.classList.add('kevin-assigned');
            
            // Apply new account class
            if (account.isNew) row.classList.add('new-account');
        }
        
        function markAsModified(index) {
            const row = document.querySelector(`tr[data-index="${index}"]`);
            row.classList.add('modified-row');
        }
        
        function updateSaveStatus(hasChanges) {
            const status = document.getElementById('saveStatus');
            hasUnsavedChanges = hasChanges;
            
            if (hasChanges) {
                status.textContent = 'Unsaved Changes';
                status.className = 'status-indicator unsaved';
            } else {
                status.textContent = 'All Saved';
                status.className = 'status-indicator saved';
            }
        }
        
        function updateRiskSummary() {
            const risks = accountData.reduce((acc, account) => {
                acc[account.risk] = (acc[account.risk] || 0) + 1;
                return acc;
            }, {});
            
            document.getElementById('riskSummary').textContent = 
                `${risks.High || 0} High Risk | ${risks.Medium || 0} Medium Risk | ${risks.Low || 0} Low Risk`;
        }
        
        function saveChanges() {
            // Simulate save to local storage
            localStorage.setItem('accountData', JSON.stringify(accountData));
            updateSaveStatus(false);
            
            // Remove modified indicators
            document.querySelectorAll('.modified-row').forEach(row => {
                row.classList.remove('modified-row');
            });
            
            alert('Changes saved successfully!');
        }
        
        function resetChanges() {
            if (confirm('Are you sure you want to reset all changes? This cannot be undone.')) {
                accountData = JSON.parse(JSON.stringify(originalData));
                renderTable();
                updateSaveStatus(false);
            }
        }
        
        function addNewAccount() {
            const newAccount = {
                name: "New Account",
                arr: "$0.00",
                renewal: "TBD",
                geo: "North America",
                commercial: "TBD",
                csm: "TBD",
                poc: "TBD",
                location: "TBD",
                engagement: "New",
                risk: "Medium",
                concerns: "New account requiring assessment",
                actionPlan: "Initial account setup and assessment",
                actionDate: "Next week",
                status: "Planned",
                kevinAssigned: "NO",
                isNew: true,
                classes: "medium-risk new-account"
            };
            
            accountData.push(newAccount);
            renderTable();
            updateSaveStatus(true);
        }
        
        function duplicateAccount(index) {
            const account = JSON.parse(JSON.stringify(accountData[index]));
            account.name += " (Copy)";
            accountData.splice(index + 1, 0, account);
            renderTable();
            updateSaveStatus(true);
        }
        
        function deleteAccount(index) {
            if (confirm('Are you sure you want to delete this account?')) {
                accountData.splice(index, 1);
                renderTable();
                updateSaveStatus(true);
            }
        }
        
        function filterTable(filter) {
            const rows = document.querySelectorAll('#accountTableBody tr');
            
            rows.forEach(row => {
                let show = false;
                
                switch(filter) {
                    case 'all':
                        show = true;
                        break;
                    case 'kevin':
                        show = row.classList.contains('kevin-assigned');
                        break;
                    case 'high-risk':
                        show = row.classList.contains('high-risk');
                        break;
                    case 'new':
                        show = row.classList.contains('new-account');
                        break;
                }
                
                row.style.display = show ? '' : 'none';
            });
        }
        
        function exportToCSV() {
            const headers = [
                'Account Name', 'Total ARR (converted)', 'Renewal Start Date', 'Geo',
                'IgniteTech Commercial Partner', 'IgniteTech CSM Partner', 'Executive POC',
                'Executive POC - Location City', 'Customer Engagement Status', 'Account Churn Risk',
                'Concerns to be addressed', 'Proposed action plan', 'Date of action plan',
                'Status of action plan', 'Kevin Assigned'
            ];
            
            let csv = headers.join(',') + '\n';
            
            accountData.forEach(account => {
                const row = [
                    account.name,
                    account.arr,
                    account.renewal,
                    account.geo,
                    account.commercial,
                    account.csm,
                    account.poc,
                    account.location,
                    account.engagement,
                    account.risk,
                    account.concerns,
                    account.actionPlan,
                    account.actionDate,
                    account.status,
                    account.kevinAssigned
                ].map(field => `"${field.replace(/"/g, '""')}"`);
                
                csv += row.join(',') + '\n';
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `account_portfolio_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }
        
        // Load saved data on page load
        window.addEventListener('load', function() {
            const saved = localStorage.getItem('accountData');
            if (saved) {
                accountData = JSON.parse(saved);
            }
            renderTable();
        });
        
        // Warn about unsaved changes
        window.addEventListener('beforeunload', function(e) {
            if (hasUnsavedChanges) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
        
        // Initialize
        renderTable();
    </script>
</body>
</html>
